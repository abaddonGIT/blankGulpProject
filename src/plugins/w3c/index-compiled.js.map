{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/**\r\n * Created by Abaddon on 28.05.2016.\r\n */\r\n'use strict';\r\n\r\nimport through from 'through2';\r\nimport w3cjs from 'w3cjs';\r\nimport gutil from 'gulp-util';\r\nimport merge from 'object-assign';\r\nimport dot from 'dot';\r\nimport tpl from './template-compiled';\r\n/**\r\n * Handles messages.\r\n *\r\n * @param file The file array.\r\n * @param messages Array of messages returned by w3cjs.\r\n * @return boolean Return false if errors have occurred.\r\n */\r\n\r\nconst TAG = \"gulp-w3c-validate\";\r\n\r\n/**\r\n * Create and show console messages view\r\n * @param response\r\n * @param file\r\n */\r\nvar showConsoleMessages = function (response, file) {\r\n    console.log(response);\r\n};\r\n\r\n/**\r\n * Create and view html messsages view\r\n * @param response\r\n */\r\nvar showHtmlMessages = function (response, content) {\r\n    let join = '</body>',\r\n        validateText = \"\",\r\n        htmlParts = content.split(join),\r\n        messages = response.messages,\r\n        msLen = messages.length;\r\n\r\n    if (htmlParts.length > 1) {\r\n        validateText = \"<!--VALIDATE-->\";\r\n        //messages.extract = messages.extract.replace(/</g, \"&lt;\");\r\n        //messages.extract = messages.extract.replace(/>/g, \"&gt;\");\r\n        let items = dot.template(tpl.messageItems)(messages);\r\n        items = items.replace(/<!--/g, \"\");\r\n        items = items.replace(/-->/g, \"\");\r\n        //validateText += dot.template(tpl.messageWrap)(items);\r\n        validateText += \"<!--VALIDATE-->\";\r\n    }\r\n    htmlParts[0] += validateText;\r\n\r\n    return prefixStream(htmlParts.join(join));\r\n};\r\n\r\n/**\r\n * Create and return file like stream\r\n * @param prefixText\r\n * @returns {*}\r\n */\r\nfunction prefixStream(prefixText) {\r\n    var stream = through();\r\n    stream.write(prefixText);\r\n    return stream;\r\n}\r\n\r\nvar validate = function (params) {\r\n    if (params == null) {\r\n        params = {};\r\n    }\r\n    params = merge(params, {\r\n        type: ['css', 'html'],\r\n        view: \"html\",//console\r\n        showJsPath: \"\"\r\n    });\r\n\r\n\r\n    return through.obj(function (file, enc, callback) {\r\n        var content = file.contents.toString();\r\n\r\n        if (file.isNull()) {\r\n            callback(null, file);\r\n        }\r\n\r\n        if (file.isStream()) {\r\n            return callback(new gutil.PluginError('gulp-w3cjs', 'Streaming not supported'));\r\n        }\r\n\r\n        if (params.view === \"html\") {\r\n            var w3cPart = content.split('<!--VALIDATE-->');\r\n\r\n            if (w3cPart.length > 1) {\r\n                w3cPart.splice(1, 1);\r\n                content = w3cPart.join(\"\");\r\n            }\r\n        }\r\n\r\n        w3cjs.validate({\r\n            input: file.contents,\r\n            output: 'json',\r\n            callback: function (res) {\r\n                switch (params.view) {\r\n                    case \"html\":\r\n                        file.contents = showHtmlMessages(res, content);\r\n                        break;\r\n                    case \"console\":\r\n                        showConsoleMessages(res, content);\r\n                        break;\r\n                }\r\n\r\n                callback(null, file);\r\n            }\r\n        });\r\n    });\r\n};\r\n\r\nexport default validate;"]}